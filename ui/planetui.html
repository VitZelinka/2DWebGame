<div style="background-color:white; width: 200px; height: 200px;">
    <div style="background-color: grey; display: flex; justify-content: flex-end;">
        <button id="ui_close_button">X</button>
    </div>
    <div>
        <p id="planet_resources">Resources:</p>
        <button id="test_upgrade">Upgrade</button>
        <p id="planet_buildtime">Until built:</p>
    </div>
</div>

<script type="module">
    console.log(global);

    let closeButton = document.getElementById("ui_close_button");
    closeButton.onclick = () => {
        global.engine.CloseUI();
    };
    let upgradeButton = document.getElementById("test_upgrade");
    let res = document.getElementById("planet_resources");
    let buildTime = document.getElementById("planet_buildtime");

    upgradeButton.onclick = () => {
        global.engine.socket.emit("c2s:upgrade_mine", {planetId: global.engine.uiData.id,
            toUpgrade: "metal"}, (response) => {
                if (response.result) {
                    const newRes = global.engine.uiData.resources.metal - global.ResFuncs.cost.metal(global.engine.uiData.mines.metal);
                    res.innerHTML = "Resoures: " + newRes;
                    global.engine.uiData.resources.metal = newRes;
                    upgradeButton.setAttribute("disabled", "");
                    console.log(response.data);
                    global.engine.uiData.jobQueue = response.data;
                    global.RandFuncs.RefreshPlanet(global.engine.uiData);
                    UpdateUI();
                    // TODO: add new job to jobQueue and calculate time and shit
                } else {
                    console.log("ERROR: not enough resources");
                }
            });
    };

    UpdateUI();

    function UpdateUI() {
        console.log("res updated");
        global.RandFuncs.RefreshPlanet(global.engine.uiData);
        console.log(global.engine.uiData.resources.metal);
        res.innerHTML = "Resoures: " + global.engine.uiData.resources.metal;
    }

    function ButtonController() {
        if (global.engine.uiData.resources.metal < 100) {
            upgradeButton.setAttribute("disabled", "");
        } else {
            upgradeButton.removeAttribute("disabled");
        }
    }

    global.engine.TickEventSubscribe(() => {UpdateUI()}, "planetUi");
    //global.engine.uiOnQuit.push(() => {global.engine.TickEventUnsubscribe("planetUi")});
    global.engine.TickEventUiOnQuitUnsubscribe("planetUi");
</script>